# Story 2.2: Send Maze Data to Clients

## Status
- [x] Draft
- [x] Approved
- [x] In Progress
- [x] Review
- [x] Done

## Story
**As a** server,
**I want** to send the complete maze data to all clients when a round starts,
**so that** they can render the game world.

## Acceptance Criteria
1. After maze generation, the server broadcasts the maze data to all connected clients via Colyseus state update.
2. All clients receive the identical maze data structure without corruption or loss.
3. The broadcast occurs immediately after roundState transitions to 'playing'.
4. Clients can access the maze data through the shared GameState schema.
5. No additional network requests are needed; data syncs automatically via Colyseus.

## Tasks / Subtasks
- [x] **Backend:** Update GameState schema to include the maze data (using ArraySchema or similar for 2D structure).
- [x] **Backend:** Ensure maze is set in GameState after generation in the start game workflow.
- [x] **Backend:** Verify Colyseus automatically broadcasts state changes to all clients.
- [x] **Shared:** Update shared types to include maze in GameState interface.
- [x] **Backend:** Add unit tests to verify maze data is correctly set and would broadcast properly.

## Dev Notes
- This story builds directly on Story 2.1, using the generated maze and existing GameState.
- Leverage Colyseus' automatic state synchronization; no manual broadcast needed if maze is set as a schema property.
- Refer to `packages/server/rooms/MazeRaceRoom.ts` for GameState updates (add maze to state after generation).
- Refer to `packages/shared/types/index.ts` for schema definitions (extend GameState with maze: Array2D<number> or similar).
- Follow existing code style: TypeScript, Colyseus schemas, 2-space indentation, camelCase naming.
- Ensure serialization efficiency for 21x21 maze (small payload).

### Testing
- Test file location: `packages/server/test/MazeRaceRoom.test.ts`
- Test standards: Use Jest for unit tests to validate maze inclusion in GameState and simulate client reception.
- Ensure tests cover state serialization and deserialization of maze data.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-10 | 1.0     | Initial draft of story.  | BMad Orchestrator |
| 2025-09-10 | 1.1     | Implemented maze data sync via Colyseus state. All acceptance criteria met. | Full Stack Developer |