# Story 1.4: Enable Start Button

## Status
- [x] Draft
- [x] Approved
- [x] In Progress
- [x] Review
- [x] Done

## Story
**As a** host,
**I want** the "Start Game" button to be enabled only when at least one other player has joined,
**so that** I can ensure everyone is ready before beginning the game.

## Acceptance Criteria
1. The "Start Game" button is initially disabled when only the host is in the lobby.
2. The "Start Game" button becomes enabled when at least one other player joins the lobby.
3. The button remains enabled as long as there are at least two players (host + one other) in the lobby.
4. When the number of players drops below two (e.g., a player leaves), the button is disabled again.
5. Clicking the enabled "Start Game" button transitions the game state from 'waiting' to 'playing' and navigates all players to the game screen.

## Tasks / Subtasks
- [x] **Frontend:** Update the lobby UI to conditionally enable/disable the "Start Game" button based on player count.
- [x] **Frontend:** Subscribe to real-time player list updates to dynamically update button state.
- [x] **Backend:** Implement server-side validation to ensure the host can only start the game when conditions are met.
- [x] **Backend:** Broadcast the game start event to all players when the host clicks the button.
- [x] **Frontend:** Handle the game start event by navigating to the game page and initializing the maze/game logic.

## Dev Notes
- This story builds upon Stories 1.1-1.3, using the existing player list and lobby functionality.
- Use the Colyseus room state to track player count and broadcast events.
- Refer to `packages/server/rooms/MazeRaceRoom.ts` for game state management (update roundState on start).
- Refer to `packages/client/pages/lobby/[roomId].tsx` for the lobby UI (add Start button with conditional logic).
- Ensure the host role is identified (e.g., first player or via sessionId).
- Follow existing code style: TypeScript, React/Next.js, shadcn/ui components, 2-space indentation, camelCase naming.

### Testing
- Test file location: `packages/client/e2e/lobby.spec.ts`, `packages/server/test/MazeRaceRoom.test.ts`
- Test standards: Use Playwright for E2E tests (simulate multiple players joining/leaving, button enable/disable, start game flow) and Jest for unit tests.
- Ensure tests cover edge cases: single player, multiple players, player leaves after joining, invalid start attempts.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-10 | 1.0     | Initial draft of story.  | BMad Orchestrator |
| 2025-09-10 | 1.1     | Completed implementation: Added conditional Start Game button in lobby UI, real-time player count validation, backend startGame message handling with host-only access and minimum 2 players requirement, gameStarted event broadcasting and client-side navigation to game page. All acceptance criteria met. Added comprehensive E2E and unit tests covering edge cases. | Full Stack Developer |