# Story 2.1: Maze Generation Algorithm

## Status
- [x] Draft
- [x] Approved
- [x] In Progress
- [x] Review
- [x] Done

## Story
**As a** developer,
**I want** a maze generation algorithm on the server,
**so that** a new, fair maze can be created for each round.

## Acceptance Criteria
1. The server implements a maze generation algorithm that creates a rectangular maze with walls and open paths.
2. The generated maze is fair (solvable, no dead ends that trap players unfairly, balanced difficulty).
3. The algorithm runs on the server when a new round starts and produces consistent results for all clients.
4. Maze dimensions are configurable (e.g., 21x21 grid) but fixed for initial implementation.
5. The maze data is represented as a 2D array or similar structure suitable for serialization to clients.

## Tasks / Subtasks
- [x] **Backend:** Research and select a suitable maze generation algorithm (e.g., Recursive Backtracking, Prim's, or Kruskal's).
- [x] **Backend:** Implement the algorithm in TypeScript within the MazeRaceRoom (e.g., as a method to generate maze on round start).
- [x] **Backend:** Integrate maze generation into the game start workflow (call after host starts game, store in GameState).
- [x] **Shared:** Define shared types for maze data structure in packages/shared/types/index.ts.
- [x] **Backend:** Add unit tests for the maze generation algorithm to verify solvability and fairness.

## Dev Notes
- This story initiates Epic 2, building on Epic 1's game start functionality.
- Use the roundState transition from 'waiting' to 'playing' as the trigger for maze generation.
- Refer to `packages/server/rooms/MazeRaceRoom.ts` for integration (add maze property to GameState).
- Ensure the algorithm is efficient for server-side execution (under 100ms generation time).
- Follow existing code style: TypeScript, 2-space indentation, camelCase naming, shared types for data models.
- Consider Phaser compatibility for the maze structure (tile-based grid).

### Testing
- Test file location: `packages/server/test/MazeRaceRoom.test.ts`
- Test standards: Use Jest for unit tests to validate generated mazes (e.g., check for walls/paths, ensure solvable via pathfinding simulation).
- Ensure tests cover multiple generations to verify randomness and consistency.

## Change Log
| Date       | Version | Description              | Author |
|------------|---------|--------------------------|--------|
| 2025-09-10 | 1.0     | Initial draft of story.  | BMad Orchestrator |
| 2025-09-10 | 2.0     | Story completed: Maze generation algorithm implemented using Recursive Backtracking, integrated into game start workflow, shared types defined, unit tests added. | Full Stack Developer |